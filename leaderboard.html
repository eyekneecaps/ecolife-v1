<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Leaderboard ‚Äì EcoLife</title>
<link rel="stylesheet" href="style.css" />
<style>
  body { background:#0a192a; color:white; font-family:system-ui,sans-serif; margin:0; padding:0; }
  .topnav { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:#000; color:white; }
  .nav-center { font-size:1.5rem; }
  .gear { font-size:1.5rem; cursor:pointer; }
  .nav-links { display:flex; gap:1rem; }
  .nav-links a { color:white; text-decoration:none; }
  .nav-links a:hover { text-decoration:underline; }
  .hamburger { display:none; font-size:1.5rem; background:none; border:none; color:white; }
  @media(max-width:600px){.hamburger{display:block}.nav-links{display:none}.nav-dropdown{display:none;position:absolute;right:1rem;top:3.5rem;background:#073763;flex-direction:column;padding:1rem;border-radius:6px;z-index:999}.nav-dropdown.show{display:flex}.nav-dropdown a{color:white;margin:0.5rem 0;text-decoration:none}}
  ul#leaderboardList{list-style:none;padding-left:0;font-size:1.1rem;}
  ul#leaderboardList li{margin:0.5rem 0;padding:0.75rem 1rem;background:#1d3b5c;border-radius:6px;display:flex;justify-content:space-between;align-items:center;}
  .rank{font-weight:bold;color:#84cc16;}
</style>
</head>
<body>

<nav class="topnav">
  <div class="nav-left"><span class="gear" onclick="window.location.href='profile.html'">‚öôÔ∏è</span></div>
  <div class="nav-center">EcoLife</div>
  <div class="nav-right nav-links">
    <a href="index.html">About Us</a>
    <a href="products.html">Services</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="leaderboard.html">Leaderboard</a>
  </div>
  <button class="hamburger" onclick="toggleMobileNav()">‚ò∞</button>
</nav>

<div class="nav-dropdown" id="mobileDropdown">
  <a href="index.html">About Us</a>
  <a href="products.html">Services</a>
  <a href="dashboard.html">Dashboard</a>
  <a href="leaderboard.html">Leaderboard</a>
</div>

<div class="auth-box" style="max-width:700px;margin:2rem auto;text-align:center;">
  <h2>üèÜ Leaderboard</h2>
  <ul id="leaderboardList">
    <li>Loading leaderboard...</li>
  </ul>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDW5APPZMu-lojVRNg89ZDBEY14YD77xd4",
  authDomain: "ecolife--v1.firebaseapp.com",
  databaseURL: "https://ecolife--v1-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ecolife--v1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const leaderboardList = document.getElementById("leaderboardList");

// Function to fetch leaderboard
async function fetchLeaderboard() {
  try {
    const snapshot = await get(ref(db, "users"));
    const users = snapshot.val() || {};
    
    // Filter users with a name only
    const validUsers = Object.values(users).filter(u => u && u.name);
    
    // Sort descending by points
    validUsers.sort((a,b) => (b.points || 0) - (a.points || 0));

    // Render leaderboard
    leaderboardList.innerHTML = "";
    if (validUsers.length === 0) {
      leaderboardList.innerHTML = "<li>No users yet.</li>";
      return;
    }

    validUsers.forEach((user, index) => {
      const trophy = index === 0 ? " ü•á" : index === 1 ? " ü•à" : index === 2 ? " ü•â" : "";
      const li = document.createElement("li");
      li.innerHTML = `<span class="rank">${index + 1}</span>. ${user.name}${trophy} <span>${user.points || 0} pts</span>`;
      leaderboardList.appendChild(li);
    });
  } catch(err) {
    console.error("Error fetching leaderboard:", err);
    leaderboardList.innerHTML = "<li>Error loading leaderboard</li>";
  }
}

// Initial fetch
fetchLeaderboard();

// Update every 6 seconds
setInterval(fetchLeaderboard, 6000);

// Mobile nav
window.toggleMobileNav = () => document.getElementById("mobileDropdown").classList.toggle("show");
</script>

</body>
</html>
